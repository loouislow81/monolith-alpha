define("client",[],function(){var e=codebox.require("underscore"),t=codebox.require("utils/dialogs"),n=codebox.require("core/box"),r=codebox.require("core/backends/rpc"),i=codebox.require("models/command"),s=codebox.require("core/commands/menu"),o=codebox.require("core/user"),u=codebox.require("vendors/crypto"),a=o.settings("deploymentSolutions"),f=function(){return r.execute("project/deployment/solutions")},l=function(t){return f().then(function(n){var r=e.find(n,function(e){return e.id==t});if(!r)throw"Invalid solution type";return r})},c=function(e){return u.MD5(e).toString()},h=function(e,t){var n=a.get("solutions",{}),r=c(e);return n[r]?null:(n[r]={name:e,type:t,settings:{}},a.set("solutions",n),n[r])},p=function(e){var t=a.get("solutions",{});return t[e]},d=function(e,t){var n=a.get("solutions",{});n[e].settings=t,a.set("solutions",n)},v=function(e){var n=p(e);return l(n.type).then(function(e){return t.fields("Configuration for "+n.name,e.settings,n.settings)}).then(function(t){return d(e,t),a.save()})},m=i.register("deploy.configure",{title:"Add Solution",offline:!1,action:function(n){f().then(function(n){return t.fields("Add Deployment Solution",{name:{type:"text",label:"Label"},solution:{type:"select",label:"Type",options:e.object(e.map(n,function(e){return[e.id,e.name]}))}})}).then(function(e){if(!e.name||!e.solution)throw"Need 'name' and 'solution'";var t=h(e.name,e.solution);if(!t)throw"Cannot add this solution";return v(c(t.name))})}}),g=s.register("deploy",{title:"Deploy"}),y=function(){g.clearMenu(),g.menuSection([m]);var t=a.get("solutions",{});g.menuSection(e.map(t,function(e){var t=i.register({title:e.name,type:"menu",offline:!1,action:function(){v(c(e.name))}});return t.menuSection([{title:"Configure",offline:!1,action:function(){v(c(e.name))}}]),t}));return};y()})