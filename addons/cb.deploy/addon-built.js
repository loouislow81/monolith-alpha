define("client",[],function(){var e=codebox.require("underscore"),t=codebox.require("utils/dialogs"),n=codebox.require("core/box"),r=codebox.require("core/backends/rpc"),i=codebox.require("models/command"),s=codebox.require("core/commands/menu"),o=codebox.require("core/user"),u=codebox.require("vendors/crypto"),a=o.settings("deploymentSolutions"),f=function(){return r.execute("project/deployment/solutions")},l=function(t){return f().then(function(n){var r=e.find(n,function(e){return e.id==t});if(!r)throw"Invalid solution type";return r})},c=function(e){return u.MD5(e).toString()},h=function(e,t){var n=a.get("solutions",{}),r=c(e);return n[r]?null:(n[r]={name:e,type:t,settings:{}},a.set("solutions",n),b(),n[r])},p=function(e){var t=a.get("solutions",{});if(!t[e])return null;delete t[e],a.set("solutions",t),b()},d=function(e){var t=a.get("solutions",{});return t[e]},v=function(e,t){var n=a.get("solutions",{});n[e].settings=t,a.set("solutions",n)},m=function(e){var n=d(e);return l(n.type).then(function(e){return t.fields("Configuration for "+n.name,e.settings,n.settings)}).then(function(t){return v(e,t),a.save()})},g=i.register("deploy.configure",{title:"Add Solution",offline:!1,action:function(n){f().then(function(n){return t.fields("Add Deployment Solution",{name:{type:"text",label:"Label"},solution:{type:"select",label:"Type",options:e.object(e.map(n,function(e){return[e.id,e.name]}))}})}).then(function(e){if(!e.name||!e.solution)throw"Need 'name' and 'solution'";var t=h(e.name,e.solution);if(!t)throw"Cannot add this solution";return m(c(t.name))})}}),y=s.register("deploy",{title:"Deploy",position:90}),b=function(){return f().then(function(t){y.clearMenu(),y.menuSection([g]);var n=a.get("solutions",{});y.menuSection(e.chain(n).map(function(n){var r=e.find(t,function(e){return e.id==n.type});if(!r)return null;var s=i.register({title:n.name,type:"menu",offline:!1,action:function(){m(c(n.name))}});return s.menuSection(e.map(r.actions,function(e){return{title:e.name,offline:!1,action:function(){alert("do "+e.id)}}})),s.menuSection([{title:"Configure",offline:!1,action:function(){m(c(n.name))}},{title:"Remove",offline:!1,action:function(){p(c(n.name))}}]),s}).compact().value())})};b()})