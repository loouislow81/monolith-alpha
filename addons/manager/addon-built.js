define("models/addon",[],function(){var e=codebox.require("hr/hr"),t=codebox.require("core/addons"),n=e.Model.extend({defaults:{name:"",git:"","package":{}},isInstalled:function(){return t.isInstalled(this.get("name"))},state:function(){return t.getState(this.get("name"))},isDefault:function(){return t.isDefault(this.get("name"))},install:function(){return t.install(this.get("git"))},uninstall:function(){return t.uninstall(this.get("name"))}});return n}),define("collections/addons",["models/addon"],function(e){var t=codebox.require("q"),n=codebox.require("hr/hr"),r=codebox.require("underscore"),i=codebox.require("core/user"),s=codebox.require("core/addons"),o=n.Collection.extend({model:e,defaults:r.defaults({loader:"allIndex",loaderArgs:[],startIndex:0,limit:10},n.Collection.prototype.defaults),getIndex:function(){var e=this;return this._index=n.Cache.get("addons","index"),this._index?t(this._index):n.Requests.getJSON(i.settings("manager").get("registry")+"/api/addons?limit=1000&callback=?").then(function(r){return e._index=r,n.Cache.set("addons",i.settings("manager").get("registry"),e._index,3600),t(e._index)})},getFromIndex:function(e,n){var i=this;return e=r.defaults({},e||{},this.options),this.getIndex().then(function(s){var o=n(s.addons);return i.add({list:o.slice(e.startIndex,e.startIndex+e.limit),n:r.size(o)}),t(o)})},allIndex:function(e){return this.getFromIndex(e,r.identity)},searchIndex:function(e,t){return e=e.toLowerCase(),this.getFromIndex(t,function(t){return r.filter(t,function(t){var n=[t.name,t["package"].description,t["package"].author,t["package"].title].join(" ").toLowerCase();return n.search(e)>=0})})},allInstalled:function(e){return this.getFromIndex(e,function(e){return r.filter(e,function(e){return s.isInstalled(e.name)})})},allAvailable:function(e){return this.getFromIndex(e,function(e){return r.filter(e,function(e){return!s.isInstalled(e.name)})})}});return o}),define("require-tools/less/normalize",[],function(){function r(e,r,i){if(e.indexOf("data:")===0)return e;e=t(e);var u=i.match(n),a=r.match(n);return a&&(!u||u[1]!=a[1]||u[2]!=a[2])?s(e,r):o(s(e,r),i)}function s(e,t){e.substr(0,2)=="./"&&(e=e.substr(2));if(e.match(/^\//)||e.match(n))return e;var r=t.split("/"),i=e.split("/");r.pop();while(curPart=i.shift())curPart==".."?r.pop():r.push(curPart);return r.join("/")}function o(e,t){var n=t.split("/");n.pop(),t=n.join("/")+"/",i=0;while(t.substr(i,1)==e.substr(i,1))i++;while(t.substr(i,1)!="/")i--;t=t.substr(i+1),e=e.substr(i+1),n=t.split("/");var r=e.split("/");out="";while(n.shift())out+="../";while(curPart=r.shift())out+=curPart+"/";return out.substr(0,out.length-1)}var e=/([^:])\/+/g,t=function(t){return t.replace(e,"$1/")},n=/[^\:\/]*:\/\/([^\/])*/,u=function(e,n,i){n=t(n),i=t(i);var s=/@import\s*("([^"]*)"|'([^']*)')|url\s*\(\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/ig,o,u,e;while(o=s.exec(e)){u=o[3]||o[2]||o[5]||o[6]||o[4];var a;a=r(u,n,i);var f=o[5]||o[6]?1:0;e=e.substr(0,s.lastIndex-u.length-f-1)+a+e.substr(s.lastIndex-f-1),s.lastIndex=s.lastIndex+(a.length-u.length)}return e};return u.convertURIBase=r,u.absoluteURI=s,u.relativeURI=o,u}),define("require-tools/less/less",["require"],function(e){var t={};t.pluginBuilder="./less-builder";if(typeof window=="undefined")return t.load=function(e,t,n){n()},less;t.normalize=function(e,t){return e.substr(e.length-5,5)==".less"&&(e=e.substr(0,e.length-5)),e=t(e),e};var n=document.getElementsByTagName("head")[0],r=window.location.href.split("/");r[r.length-1]="",r=r.join("/");var i;window.less=window.less||{env:"development"};var s=0,o;t.inject=function(e){s<31&&(o=document.createElement("style"),o.type="text/css",n.appendChild(o),s++),o.styleSheet?o.styleSheet.cssText+=e:o.appendChild(document.createTextNode(e))};var u;return t.load=function(n,s,o,a){e(["./lessc","./normalize"],function(a,f){if(!i){var l=e.toUrl("base_url").split("/");l[l.length-1]="",i=f.absoluteURI(l.join("/"),r)+"/"}var c=s.toUrl(n+".less");c=f.absoluteURI(c,i),u=u||new a.Parser(window.less),u.parse('@import "'+c+'";',function(e,n){if(e)return o.error(e);t.inject(f(n.toCSS(),c,r)),setTimeout(o,7)})})},t}),define("require-tools/less/less!stylesheets/addons",[],function(){}),define("views/addons",["collections/addons","less!stylesheets/addons"],function(e){var t=codebox.require("hr/hr"),n=codebox.require("underscore"),r=t.List.Item.extend({className:"addon-item",templateLoader:"addon.manager.templates",template:"addon.html",events:{"click .action-install":"install","click .action-uninstall":"uninstall"},install:function(e){e&&e.preventDefault();var t=this.$(".action-install");t.button("loading"),this.model.install().then(n.bind(this.render,this)).fin(function(){t.button("reset")})},uninstall:function(e){e&&e.preventDefault();var t=this.$(".action-install");t.button("loading"),this.model.uninstall().then(n.bind(this.render,this)).fin(function(){t.button("reset")})}}),i=t.List.extend({className:"addons-list",Collection:e,Item:r,defaults:n.defaults({},t.List.prototype.defaults)});return i}),define("views/dialog",["views/addons"],function(e){var t=codebox.require("jQuery"),n=codebox.require("views/dialogs/base"),r=codebox.require("utils/dialogs"),i=codebox.require("core/addons"),s=n.extend({className:"addon-manager-dialog modal fade",templateLoader:"addon.manager.templates",template:"dialog.html",events:_.extend({},n.prototype.events,{"keyup .search-input":"search","click .action-fromurl":"installFromUrl","click a[data-addons]":"filterAddons"}),initialize:function(t){return s.__super__.initialize.apply(this,arguments),this.list=new e,this},finish:function(){return this.list.$el.appendTo(this.$(".list")),s.__super__.finish.apply(this,arguments)},installFromUrl:function(e){e&&e.preventDefault(),r.prompt("GIT url for the addon:","").then(function(e){i.install(e).then(function(){r.alert("Installation","Add-on installed with success!")},function(){r.alert("Installation","Sorry, installation failed, please check that the url you entered is correct and the GIT repository a correct CodeBox add-on.")})})},search:function(e){var n=t(e.currentTarget).val();this.list.collection.reset([]),n.length>0?this.list.collection.searchIndex(n):this.list.collection.allIndex()},filterAddons:function(e){e.preventDefault();var n=t(e.currentTarget).data("addons"),r={all:"allIndex",installed:"allInstalled",available:"allAvailable"};this.list.collection.reset([]),this.list.collection[r[n]]()}});return s}),define("client",["views/dialog"],function(e){var t=codebox.require("core/commands"),n=codebox.require("core/app"),r=codebox.require("utils/dialogs"),i=codebox.require("core/settings");i.add({namespace:"manager",title:"Addons",defaults:{registry:"https://api.codebox.io"},fields:{registry:{label:"Registry",type:"text"}}}),t.register("addons.installer",{title:"Add-ons",icon:"puzzle-piece"},function(){r.open(e)})}),function(e){var t=document,n="appendChild",r="styleSheet",i=t.createElement("style");i.type="text/css",t.getElementsByTagName("head")[0][n](i),i[r]?i[r].cssText=e:i[n](t.createTextNode(e))}("@media screen and (min-width:768px){.addon-manager-dialog .modal-dialog{width:760px}}.addon-manager-dialog .search-input{float:right;width:200px;border:1px solid #ddd;padding:5px;margin-top:-5px}.addon-manager-dialog .search-input:hover,.addon-manager-dialog .search-input:focus{outline:0}.addon-manager-dialog .addons-list{list-style:none;padding:0;margin:25px 0 0}.addon-manager-dialog .addons-list .hr-list-message-more{text-align:center;background:#eee;margin:0}.addon-manager-dialog .addons-list .addon-item{min-height:60px;margin:10px 0}.addon-manager-dialog .addons-list .addon-item p{margin:0}.addon-manager-dialog .addons-list .addon-item p.name{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.addon-manager-dialog .addons-list .addon-item .base{float:left;width:100px;margin-right:10px}.addon-manager-dialog .addons-list .addon-item .base .version{color:#666}.addon-manager-dialog .addons-list .addon-item .more{margin-left:110px}.addon-manager-dialog .addons-list .addon-item .actions{float:right;margin-left:10px}")